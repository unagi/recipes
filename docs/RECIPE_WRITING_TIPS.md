# レシピ作成の詳細ガイド

このドキュメントは、レシピ作成の詳細な技術情報を提供します。基本的な情報は [RECIPE_GUIDE.md](./RECIPE_GUIDE.md) を参照してください。

---

## `recipeId`のルール（必須）

- **用途**: 詳細ページのURL `/recipes/<recipeId>/` に使用
- **文字種**: 英小文字 + 数字 + `-` のみ
- **最大長**: 40文字
- **命名基準**: 料理名ベースの短い識別子（英訳/ローマ字化どちらも可）
- **例**:
  ```yaml
  recipeId: "spice-soup-curry"
  recipeId: "okinawa-vegetable-soba"
  ```

## 任意フィールド

以下のフィールドは任意ですが、適切に記入することでレシピの情報量が増します。

### `prepTime`（数値、分）
- **ルール**: 下準備時間（分単位）
- **データ形式**: 数値（分）で記録し、表示時に `formatPrepTime()` で自動変換
- **表示例**:
  - 30分 → 「30分」
  - 720分（12時間） → 「一晩」
  - 1440分（24時間） → 「1日」
  - 2880分（48時間） → 「2-3日程度」
- **記入例**:
  ```yaml
  prepTime: 30      # 表示: 30分
  prepTime: 720     # 表示: 一晩（漬け込み時間など）
  prepTime: 1440    # 表示: 1日（塩漬け、発酵など）
  ```

#### 時間表記のガイドライン

時間は常に**数値（分単位）**で記録し、表示側で慣用的な表現に変換されます：

| 分 | 時間 | 表示 | 用途例 |
|----|------|------|-------|
| 30 | 0.5h | 「30分」 | マリネ、下ごしらえ |
| 120 | 2h | 「2時間」 | 生地の寝かせ |
| 360 | 6h | 「半日程度」 | 冷蔵発酵 |
| 720 | 12h | 「一晩」 | 漬け込み、味噌漬け |
| 1440 | 24h | 「1日」 | ベーコンの塩漬け |
| 2880 | 48h | 「2-3日程度」 | チャーシューの漬け込み |
| 10080 | 7日 | 「1週間」 | ぬか漬け |

### `cookTime`（数値、分）
- **ルール**: 調理時間（分単位）
- **例**:
  ```yaml
  cookTime: 45
  ```

### `equipment`（配列）
- **ルール**:
  - **経口摂取しないもの**（道具、器具、容器など）
  - 特殊な道具がある場合に記載
- **例**:
  ```yaml
  equipment:
    - "イージースモーカー（家庭用燻製機）"
    - "燻製用チップ（大さじ1）"
    - "ジップロック（密閉できる保存袋）"
  ```

### `category`（文字列）
- **ルール**: 料理のカテゴリ（1つのみ）
- **例**:
  ```yaml
  category: "カレー"
  category: "パスタ"
  category: "燻製"
  ```

### `tags`（配列）
- **ルール**: 検索用タグ（複数可）
- **詳細**: タグの設計・統合ルールは `docs/agents/TAGGING.md` を参照
- **例**:
  ```yaml
  tags: ["スープ料理", "郷土料理"]
  tags: ["麺料理", "豚バラ", "作り置き"]
  ```

### `difficulty`（列挙型）
- **ルール**: `easy` | `medium` | `hard`
- **例**:
  ```yaml
  difficulty: "medium"
  ```

### `image`（文字列）
- **ルール**: 画像ファイルのパス（将来の拡張用）
- **例**:
  ```yaml
  image: "/images/recipes/spice-soup-curry.jpg"
  ```

### `updatedDate`（日付）
- **ルール**: レシピ更新日（更新時のみ記載）
- **例**:
  ```yaml
  updatedDate: 2024-02-15
  ```

---

## Markdown本文の構造

### 必須セクション

#### `## レシピのポイント`
- **目的**: レシピの概要と特徴を説明
- **記載内容**: レシピの背景、特徴、おすすめポイント
- **例**:
  ```markdown
  ## レシピのポイント

  このレシピは、シンプルな材料で作れる本格的なイタリアンパスタです。
  ```

### 推奨セクション

#### `### コツ`
- **目的**: 成功のポイントを箇条書き
- **記載内容**: 失敗しやすい部分、重要な工程、味の決め手
- **例**:
  ```markdown
  ### コツ

  - **玉ねぎを焦がしすぎない**: きつね色になるまでじっくり炒める
  - **乳化が重要**: 茹で汁とオリーブオイルをしっかり乳化させる
  - **塩加減**: パスタの茹で汁に塩がしっかり入っていることが大切
  ```

### 任意セクション（レシピの種類に応じて追加）

#### `### 事前準備` / `### 必要な道具`
- **使用タイミング**: 複雑なレシピ、特殊な道具が必要な場合
- **例**:
  ```markdown
  ### 事前準備

  このレシピでは以下の材料を事前に準備しておくと便利です（冷凍保存可能）：

  **鶏がらスープの作り方**:
  1. 鶏ガラ1羽分を水で洗い、血合いを取り除く
  2. 大きめの鍋に鶏ガラ、水2リットル、長ネギの青い部分、生姜を入れる
  3. 強火で沸騰させ、アクを取り除く
  4. 弱火で2-3時間煮込む
  5. ザルで濾して完成（冷凍保存可能）
  ```

#### `### アレンジ`
- **使用タイミング**: バリエーションが豊富な料理
- **例**:
  ```markdown
  ### アレンジ

  - ベーコンやアンチョビを加えると、より旨味が増します
  - 仕上げにバターを加えるとコクが出ます
  - 唐辛子を加えてペペロンチーノ風にしても美味しいです
  ```

#### `### 保存方法`
- **使用タイミング**: `ingredient`、`sauce`、`preserve`など作り置きできるもの
- **例**:
  ```markdown
  ### 保存方法

  - 冷蔵保存: 3-5日
  - 冷凍保存: 1ヶ月（スライスしてラップで包んでから冷凍）
  ```

#### `### 使い方`
- **使用タイミング**: `ingredient`、`sauce`など他の料理に使う材料
- **例**:
  ```markdown
  ### 使い方

  - そのままスライスして: サンドイッチやサラダに
  - 加熱して: カルボナーラやパスタの具材に
  - 厚切りで: ステーキとして焼いても美味
  ```

#### `## 注意事項`
- **使用タイミング**: 安全上の注意が必要な場合
- **例**:
  ```markdown
  ## 注意事項

  - 燻製機の使用方法は、機種によって異なります。取扱説明書を確認してください
  - 室内で燻製する場合は、換気を十分に行ってください
  - 肉の中心温度が63°C以上になるよう、加熱時間を調整してください
  ```

#### `## 栄養情報`
- **使用タイミング**: 栄養成分が計算できる場合（将来の拡張）
- **例**:
  ```markdown
  ## 栄養情報（1人分・概算）

  - カロリー: 約450kcal
  - タンパク質: 約12g
  - 炭水化物: 約75g
  - 脂質: 約12g
  ```

#### `## トッピングのおすすめ`
- **使用タイミング**: カレー、ラーメンなどトッピングが重要な料理
- **例**:
  ```markdown
  ## トッピングのおすすめ

  - かぼちゃ（素揚げ）
  - なす（素揚げ）
  - ゆで卵または目玉焼き
  - 鶏もも肉（骨付き）
  ```

#### `## 出典`
- **使用タイミング**: 外部ソースから引用した場合のみ
- **重要**: オリジナルレシピには出典セクションを追加しない
- **例**:
  ```markdown
  ## 出典

  - Cookpad: https://cookpad.com/jp/recipes/12345678
  ```

---

## 外部ソースからの抽出ルール

### Cookpadからの抽出

#### 基本方針
- **尊重**: オリジナルレシピの意図を尊重
- **忠実**: 材料や手順は原則として変更しない
- **補完**: 不明確な部分は常識的に補完

#### 抽出ルール

##### 1. タイトル
- Cookpadのタイトルをベースに、必要に応じて【本格】【簡単】などを追加
- 原則として元のタイトルを尊重

##### 2. 材料
- **分量表記の統一**:
  - "大さじ1" → そのまま
  - "1個" → "1個（中サイズ）"など補足を追加可
  - "適量" → そのまま（無理に数値化しない）
- **グループ分け**:
  - 材料が10個以上の場合、意味のあるグループに分ける
  - 例: "スパイス"、"調味料"、"スープベース"、"トッピング"
  - **冗長なグループ名を避ける**:
    - レシピタイトルで自明な場合は省略（例: 漬けダレレシピで全材料が「漬けダレ」グループ）
    - 目安量を示す場合は明示的に（例: `group: "漬け込み対象（目安）"`）
  - **グループが1つしかない場合は省略を検討**

##### 3. 手順
- Cookpadの手順番号に従う
- 各ステップは「〜する」で終わる
- 長い手順は適宜分割

##### 4. 調理時間
- Cookpadに記載がある場合はそのまま使用
- 記載がない場合:
  - `prepTime`: 下準備が必要な場合のみ記載（漬け込み時間など）
  - `cookTime`: 実際の加熱時間のみ記載

##### 5. 難易度
- Cookpadに記載がある場合は参考にする
- 記載がない場合は以下の基準で判断:
  - `easy`: 材料5個以下、手順5個以下、特殊な道具不要
  - `medium`: 材料10個前後、手順10個前後、一般的な道具
  - `hard`: 材料15個以上、手順15個以上、特殊な道具必要

##### 6. カテゴリとタグ
- **category**: 料理の主要カテゴリ1つ（カレー、パスタ、燻製など）
- **tags**: 複数可（本格、スパイス、節約、ベジタリアンなど）

### 他のソースからの抽出

- 基本方針はCookpadと同じ
- 著作権に配慮し、手順は自分の言葉で書き直す
- 出典を`description`または本文に記載することを検討

---

## よくあるケースの対処法

### 1. 分量が不明確な場合

#### ケース: "適量"、"お好み"
- **対処**: そのまま記載
- **例**:
  ```yaml
  - name: "塩"
    amount: "適量"
  - name: "唐辛子粉"
    amount: "お好み"
  ```

#### ケース: "少々"、"ひとつまみ"
- **対処**: そのまま記載
- **例**:
  ```yaml
  - name: "タイム"
    amount: "少々"
  - name: "塩"
    amount: "ひとつまみ"
  ```

#### ケース: "大きめ1個"、"中サイズ2個"
- **対処**: 括弧で補足
- **例**:
  ```yaml
  - name: "玉ねぎ"
    amount: "1個（大きめ）"
  - name: "じゃがいも"
    amount: "2個（中サイズ）"
  ```

### 2. 調理時間が可変の場合

#### ケース: "30分以上"
- **対処**: 最小時間を記載、本文で説明
- **例**:
  ```yaml
  cookTime: 30
  ```
  ```markdown
  ### コツ
  - **煮込み時間**: 30分以上煮込むことで、スパイスの香りと旨味が十分に抽出されます
  ```

#### ケース: 下準備に長時間（漬け込み等）
- **対処**: `prepTime`に記載
- **例**:
  ```yaml
  prepTime: 1440  # 24時間
  cookTime: 50
  ```

### 3. 材料と道具の区別

#### 原則
- **経口摂取するもの** → `ingredients`
- **経口摂取しないもの** → `equipment`

#### 判断に迷うケース

| 項目 | 分類 | 理由 |
|-----|------|------|
| 燻製用チップ | `equipment` | 煙になるだけで食べない |
| ラップ、ジップロック | `equipment` | 道具 |
| クッキングシート | `equipment` | 道具 |
| パスタの茹で汁 | `ingredients` | 料理に使う |
| 揚げ油 | `ingredients` | 一部が料理に残る |
| 竹串（串焼き用） | `equipment` | 食べない（刺すだけ） |
| 爪楊枝（盛り付け用） | `equipment` | 食べない |

### 4. yieldの決定

#### ケース: 正確な量がわかる
- **対処**: `amount`を使用
- **例**:
  ```yaml
  yield:
    amount: 500
    unit: "ml"
  ```

#### ケース: 調理中に脱水・蒸発する
- **対処**: レンジ表記（`min`と`max`）を使用
- **例**:
  ```yaml
  yield:
    min: 375
    max: 425
    unit: "g"
  ```
- **補足**: 本文で元の材料の量を説明
  ```markdown
  豚バラブロック500gから、約375-425gのベーコンができます（調理中の脱水により約15-25%減少）。
  ```

#### ケース: 量が測定できない
- **対処**: `yield`フィールド自体を省略
- **例**: `recipeType: "ingredient"`でも`yield`は任意なので省略可

### 5. 複数の調理法がある場合

#### ケース: "フライパンまたはオーブンで"
- **対処**: 主要な方法を手順に記載、代替方法を本文に記載
- **例**:
  ```yaml
  steps:
    - "フライパンで中火で10分焼く"
  ```
  ```markdown
  ### アレンジ
  - オーブンで調理する場合: 180°Cで15分焼く
  ```

### 6. グループの使い方

#### 使用タイミング
- 材料が10個以上ある場合
- 意味のあるグループに分けられる場合

#### グループ名の例
- `スパイス`: スパイス類
- `調味料`: 塩、砂糖、醤油など
- `スープベース`: スープの基本材料
- `トッピング`: 最後にのせるもの
- `仕上げ`: 最後に加えるもの
- `メイン`: 主材料
- `ハーブ`: ハーブ類
- `野菜`: 野菜類

#### 例
```yaml
ingredients:
  - name: "豚バラブロック"
    amount: "500g"
    group: "メイン"
  - name: "塩"
    amount: "小さじ2"
    group: "調味料"
  - name: "セージ"
    amount: "2～3枚"
    group: "ハーブ"
```

---

## トラブルシューティング

### よくあるバリデーションエラー

#### エラー: "dish タイプの場合は servings（人数）が必須です"
- **原因**: `recipeType: "dish"`なのに`servings`が未記入
- **解決**:
  ```yaml
  recipeType: "dish"
  servings: 2  # 追加
  ```

#### エラー: "amount または (min と max) のいずれかが必須です"
- **原因**: `yield`に`amount`も`min`+`max`も記載されていない
- **解決** (単一値):
  ```yaml
  yield:
    amount: 500
    unit: "ml"
  ```
- **解決** (レンジ):
  ```yaml
  yield:
    min: 375
    max: 425
    unit: "g"
  ```

#### エラー: "ingredients は最低1つ必要です"
- **原因**: `ingredients`が空配列
- **解決**: 最低1つの材料を追加

#### エラー: "steps は最低1つ必要です"
- **原因**: `steps`が空配列
- **解決**: 最低1つの手順を追加

#### エラー: "publishedDate は必須です"
- **原因**: `publishedDate`が未記入
- **解決**:
  ```yaml
  publishedDate: 2024-01-16
  ```

### ビルドエラー

#### エラー: "Unexpected token"
- **原因**: YAMLの構文エラー（インデント、コロン、ダッシュなど）
- **解決**:
  - インデントを確認（スペース2つ）
  - `- `の後にスペースがあるか確認
  - `:`の後にスペースがあるか確認

#### エラー: "Expected string, received number"
- **原因**: 文字列フィールドに数値を記入
- **解決**: ダブルクォートで囲む
  ```yaml
  # ❌ 間違い
  amount: 2個

  # ✅ 正しい
  amount: "2個"
  ```

### その他の問題

#### 問題: レシピが表示されない
- **原因**: frontmatterの形式が間違っている
- **確認**:
  1. `---`で囲まれているか
  2. すべての必須フィールドが記入されているか
  3. `npm run build`でエラーが出ないか

#### 問題: 画像が表示されない
- **原因**: 画像パスが間違っている（将来の問題）
- **確認**:
  1. `public/images/recipes/`に画像があるか
  2. `image: "/images/recipes/xxx.jpg"`のパスが正しいか

---

## 参考

- [RECIPE_GUIDE.md](./RECIPE_GUIDE.md) - 基本的なレシピ作成手順
- [RECIPE_EXAMPLES.md](./RECIPE_EXAMPLES.md) - 豊富な実例集
- [SCHEMA.md](./SCHEMA.md) - スキーマの詳細仕様
- [AGENTS.md](../AGENTS.md) - 開発ガイド
