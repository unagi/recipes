# レシピスキーマ定義 v1.0（ドラフト）

## 概要

このドキュメントは、レシピコンテンツコレクションのスキーマ定義を記載しています。
実際のレシピを登録しながら、問題点があれば随時修正していきます。

**スキーマファイル**: `src/content/config.ts`

## 設計方針

### 1. 必須項目は最小限
- タイトル、材料、手順のみを必須とし、その他はオプション
- 段階的に情報を追加できる柔軟性を確保

### 2. Schema.org互換
- SEO対策として、Schema.orgの Recipe 型に対応できる構造
- 将来的にJSON-LDでの出力を想定

### 3. 型安全性
- TypeScript + Zodによる厳密なバリデーション
- Astro Content Collectionsの型推論を活用

## スキーマ定義

### 基本情報

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `title` | `string` | ✅ | レシピのタイトル | "【本格】焦がしたまねぎのシンプルパスタ" |
| `description` | `string` | ✅ | レシピの説明文 | "コンソメ不使用だけれど旨味十分..." |

**注意**: `description` は必須ですが、空文字でもOK（デフォルト値: `""`）

### レシピタイプ

| フィールド | 型 | 必須 | 説明 | 値 |
|-----------|-----|-----|------|-----|
| `recipeType` | `enum` | ✅ | レシピの種類 | `"dish"` \| `"ingredient"` \| `"sauce"` \| `"stock"` \| `"condiment"` \| `"preserve"` |

**レシピタイプの説明:**
- `dish`: 完成料理（パスタ、カレー、炒め物等）
- `ingredient`: 中間材料（ベーコン、ピクルス等）
- `sauce`: ソース（トマトソース、ペスト等）
- `stock`: だし・スープストック（鶏がらスープ、野菜だし等）
- `condiment`: 調味料（自家製味噌、塩麹等）
- `preserve`: 保存食（ジャム、コンフィ等）

### 人数・できあがり量

**どちらか一方は必須です。**

| フィールド | 型 | 必須 | 説明 | 使用タイプ | 例 |
|-----------|-----|-----|------|-----------|-----|
| `servings` | `number` | ⚠️ | 何人分 | `dish` | `2` |
| `yield` | `object` | ⚠️ | できあがり量 | `dish`以外 | `{ amount: 500, unit: "g" }` |

**yieldオブジェクト:**

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `amount` | `number` | ⚠️ | 数量（単一値・正確な量） | `300` |
| `min` | `number` | ⚠️ | 最小値（レンジ表記） | `375` |
| `max` | `number` | ⚠️ | 最大値（レンジ表記） | `425` |
| `unit` | `string` | ✅ | 単位 | `"g"`, `"ml"`, `"個"` |

**⚠️ 注意**: `amount` または `(min と max)` のいずれかが必須

**レンジ表記の使い分け:**
- **正確な量がわかる**: `amount` を使用
  - 例: ボトル詰めするソース、計量可能なもの
- **出来上がり量が変動する**: `min` と `max` を使用
  - 例: 燻製（水分が抜ける）、煮詰める（蒸発量が変動）

**使い分けの例:**
- 完成料理（dish）: `servings: 2`（2人分）
- ベーコン（ingredient）: `yield: { min: 375, max: 425, unit: "g" }`（水分減少のため変動）
- トマトソース（sauce）: `yield: { amount: 300, unit: "ml" }`（正確に計量可能）
- 鶏がらスープ（stock）: `yield: { min: 750, max: 850, unit: "ml" }`（煮詰め具合で変動）

### 調理時間

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `cookTime` | `number` | - | 調理時間（分） | `15` |
| `prepTime` | `number` | - | 準備時間（分） | `5` |

**注意**:
- `cookTime` と `prepTime` は正の整数のみ
- 合計時間は自動計算する想定
- 長時間の場合は分単位で記載（例: 24時間 = `1440`分）

### 材料

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|-----|------|
| `ingredients` | `array` | ✅ | 材料リスト |

**材料オブジェクト**:

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `name` | `string` | ✅ | 材料名 | "スパゲティ（1.6mm）" |
| `amount` | `string` | ✅ | 分量 | "200g" |
| `group` | `string` | - | グループ名 | "ソース用" |

**分量の記載方法**:
- 自由形式の文字列
- 例: "200g", "大さじ2", "適量", "1個（中サイズ）"

**グループの使用例**:
```yaml
ingredients:
  - name: "スパゲティ"
    amount: "200g"
    group: "メイン"
  - name: "トマト缶"
    amount: "1缶"
    group: "ソース"
  - name: "バジル"
    amount: "適量"
    group: "トッピング"
```

### 手順

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|-----|------|
| `steps` | `string[]` | ✅ | 調理手順の配列（最低1つ） |

**記載方法**:
- 1つの手順を1つの文字列として配列に格納
- 自動的に番号が付与される想定
- 各手順は簡潔に、具体的に記載

**例**:
```yaml
steps:
  - "大きめの鍋にたっぷりの水を沸かし、塩を加える"
  - "にんにくを薄切りにする"
  - "玉ねぎを薄切りにする"
```

### 調理器具・道具

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|-----|------|
| `equipment` | `string[]` | - | 調理器具・道具のリスト（経口摂取しないもの） |

**重要な設計意図**:
- **経口摂取しないもの**を記載する
- 将来的な栄養成分計算で、材料とequipmentを区別できるようにする
- 材料リストには食材のみを含める

**記載するもの**:
- 調理器具: フライパン、鍋、包丁、まな板
- 保存容器: ジップロック、保存瓶、ラップ
- 調理補助: 燻製用チップ、クッキングシート
- 測定器具: 計量カップ、温度計

**記載しないもの**:
- 一般的すぎる道具（箸、お皿等）
- 明らかなもの（水を沸かすのに鍋が必要、等）

**例**:
```yaml
equipment:
  - "イージースモーカー（家庭用燻製機）"
  - "燻製用チップ（大さじ1）"
  - "ジップロック（密閉できる保存袋）"
  - "キッチンペーパー"
  - "保存容器"
```

### カテゴリ・タグ

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `category` | `string` | - | メインカテゴリ | "パスタ" |
| `tags` | `string[]` | - | タグリスト | `["シンプル", "節約"]` |

**カテゴリの例**:
- パスタ、和食、中華、洋食、デザート、スープ、サラダ、etc.

**タグの例**:
- 節約、時短、ヘルシー、ベジタリアン、グルテンフリー、作り置き、etc.

### 画像

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `image` | `string` | - | 画像ファイルパス | "/images/recipes/pasta.jpg" |

**画像の配置**:
- `public/images/recipes/` に配置を推奨
- 相対パスで指定

### 難易度

| フィールド | 型 | 必須 | 説明 | 値 |
|-----------|-----|-----|------|-----|
| `difficulty` | `enum` | - | 難易度 | `"easy"` \| `"medium"` \| `"hard"` |

### 公開日

| フィールド | 型 | 必須 | 説明 | 例 |
|-----------|-----|-----|------|-----|
| `publishedDate` | `Date` | ✅ | 公開日 | `2024-01-16` |
| `updatedDate` | `Date` | - | 更新日 | `2024-01-20` |

**注意**:
- YAML形式で日付を記載（`YYYY-MM-DD`）
- Zodの `coerce.date()` で自動変換

## サンプルレシピ

### 例1: 完成料理（dish）

```yaml
---
title: "【本格】焦がしたまねぎのシンプルパスタ"
description: "コンソメ不使用だけれど旨味十分。一食100円位の節約レシピですが、シンプルでおいしい、メインディッシュの引き立て役です。"
recipeType: "dish"
servings: 2
cookTime: 15

ingredients:
  - name: "スパゲティ（1.6mm）"
    amount: "200g"
  - name: "玉ねぎ"
    amount: "1個（中サイズ）"
  - name: "にんにく"
    amount: "2片"
  - name: "オリーブオイル"
    amount: "大さじ2"
  - name: "パスタのゆで汁"
    amount: "大さじ4"

steps:
  - "大きめの鍋にたっぷりの水を沸かし、塩を加える"
  - "にんにくを薄切りにする"
  - "玉ねぎを薄切りにする"
  - "フライパンにオリーブオイルとにんにくを入れて弱火で加熱する"
  - "にんにくの香りが立ったら玉ねぎを加えて、きつね色になるまで中火で炒める"
  - "パスタを茹でる（袋の表示時間より1分短め）"
  - "パスタの茹で汁を大さじ4杯取っておく"
  - "玉ねぎのフライパンに茹で汁を加えて、フライパンを揺すりながら乳化させる"
  - "茹で上がったパスタをフライパンに加えて、全体をよく和える"
  - "器に盛り付けて完成。お好みで黒胡椒やパルメザンチーズをかける"

category: "パスタ"
tags: ["シンプル", "節約", "ベジタリアン", "イタリアン"]
difficulty: "easy"
publishedDate: 2024-01-16
---
```

### 例2: 中間材料（ingredient）

```yaml
---
title: "イージースモーカーでつくる即席ベーコン"
description: "ソミュール液不要で、家庭用の燻製機で手軽にできるベーコンです。"
recipeType: "ingredient"
yield:
  min: 375
  max: 425
  unit: "g"
prepTime: 1440  # 24時間
cookTime: 50

ingredients:
  - name: "豚バラブロック"
    amount: "500g"
  - name: "塩"
    amount: "小さじ2"
  - name: "砂糖"
    amount: "小さじ2"
  # ... 他の材料

steps:
  - "豚バラブロックに塩、砂糖を塗り込む"
  - "ジップロックで1日以上漬け込む"
  - "燻製機で燻製する"
  # ... 他の手順

category: "燻製"
tags: ["ベーコン", "燻製", "保存食"]
difficulty: "medium"
publishedDate: 2024-01-16
---
```

## 将来の拡張候補

以下のフィールドは現在未実装ですが、将来的に追加を検討しています：

### 栄養情報
```typescript
nutrition?: {
  calories?: number          // カロリー（kcal）
  protein?: number           // タンパク質（g）
  carbohydrates?: number     // 炭水化物（g）
  fat?: number               // 脂質（g）
  sodium?: number            // 塩分（mg）
}
```

### アレルギー情報
```typescript
allergens?: string[]        // ["小麦", "乳", "卵"]
```

### 手順ごとの画像
```typescript
steps: {
  description: string
  image?: string
}[]
```

### 保存方法
```typescript
storage?: {
  method: string            // "冷蔵保存"
  duration: string          // "3日間"
}
```

### コスト
```typescript
cost?: {
  amount: number           // 100
  currency: string         // "JPY"
  perServing: boolean      // true
}
```

## スキーマ変更履歴

### v1.3 (2024-01-16) - equipmentフィールド追加とバリデーション修正

- **equipmentフィールドを追加**（任意）
  - 調理器具・道具のリスト（経口摂取しないもの）
  - 将来の栄養成分計算のため、食材と道具を明確に分離
- **バリデーションルールを修正**
  - 変更前: servings または yield のいずれかが必須
  - 変更後: **dishの場合のみservingsが必須**、それ以外は任意
- ベーコンレシピから「燻製用チップ」「ジップロック」をequipmentに移動

**背景**:
- 栄養成分計算を行う際、経口摂取しないもの（道具・チップ等）を除外する必要がある
- ingredient/sauce/stock等では、材料リストから量を把握できればyieldは任意で良い
- 材料リストは純粋に食材のみとし、道具は別管理する

### v1.2 (2024-01-16) - yieldのレンジ表記対応

- **yieldフィールドをレンジ表記に対応**
  - `amount`: 単一値（正確な量がわかる場合）
  - `min`, `max`: レンジ表記（出来上がり量が変動する場合）
  - バリデーション: `amount` または `(min と max)` のいずれかが必須
- ベーコンレシピを `yield: { min: 375, max: 425, unit: "g" }` に更新

**背景**:
- 燻製や煮詰め料理では、水分の蒸発により出来上がり量が変動する
- 正確な量を記載できない場合でも、おおよその範囲を示せるようにした
- 原材料の量（豚バラブロック500g）は材料リストから把握できる

### v1.1 (2024-01-16) - recipeTypeとyieldの追加
- **recipeType**フィールドを追加（必須）
  - `dish`, `ingredient`, `sauce`, `stock`, `condiment`, `preserve`
- **yield**フィールドを追加（dish以外で使用）
  - できあがり量を`{ amount: number, unit: string }`で表現
- **servings**を必須からオプションに変更
  - dish用として使用
- **バリデーション**: servingsとyieldのどちらか一方は必須

**背景**:
- ベーコンなどの中間材料では「人数」ではなく「できあがり量」で表現すべき
- レシピの種類によって適切な情報が異なることが判明

### v1.0 (2024-01-16) - 初版
- 基本的なレシピスキーマを定義
- 必須項目: title, description, servings, ingredients, steps, publishedDate
- オプション項目: cookTime, prepTime, category, tags, image, difficulty, updatedDate

## 問題点・改善案

実際にレシピを登録しながら、以下のような問題があれば記録し、スキーマを改善します：

- [ ] フィールドの過不足
- [ ] バリデーションルールの妥当性
- [ ] データ型の適切性
- [ ] 必須/オプションの見直し
- [ ] 実装上の課題

## 参考リンク

- [Schema.org - Recipe](https://schema.org/Recipe)
- [Astro Content Collections](https://docs.astro.build/en/guides/content-collections/)
- [Zod Documentation](https://zod.dev/)
