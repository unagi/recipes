---
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { type CollectionEntry, getCollection, render } from 'astro:content';

export async function getStaticPaths() {
	const recipes = await getCollection('recipes');
	return recipes.map((recipe) => ({
		params: { slug: recipe.slug },
		props: { recipe },
	}));
}

type Props = {
	recipe: CollectionEntry<'recipes'>;
};

const { recipe } = Astro.props;
const { Content } = await render(recipe);

const formatMinutes = (minutes?: number): string => (minutes ? `${minutes}分` : '—');
const formatYield = (
	yieldData?: CollectionEntry<'recipes'>['data']['yield']
): string => {
	if (!yieldData) {
		return '—';
	}
	if (yieldData.amount !== undefined) {
		return `${yieldData.amount}${yieldData.unit}`;
	}
	return `${yieldData.min ?? '?'}〜${yieldData.max ?? '?'}${yieldData.unit}`;
};
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={recipe.data.title} description={recipe.data.description} />
	</head>
	<body>
		<Header />
		<main>
			<article>
				<header class="recipe-header">
					<p class="recipe-type">{recipe.data.recipeType}</p>
					<h1>{recipe.data.title}</h1>
					{recipe.data.description && <p class="description">{recipe.data.description}</p>}
				</header>

				<section class="recipe-meta">
					<dl>
						<dt>人数</dt>
						<dd>{recipe.data.servings ? `${recipe.data.servings}人分` : '—'}</dd>
						<dt>できあがり量</dt>
						<dd>{formatYield(recipe.data.yield)}</dd>
						<dt>準備時間</dt>
						<dd>{formatMinutes(recipe.data.prepTime)}</dd>
						<dt>調理時間</dt>
						<dd>{formatMinutes(recipe.data.cookTime)}</dd>
						<dt>カテゴリ</dt>
						<dd>{recipe.data.category ?? '—'}</dd>
						<dt>タグ</dt>
						<dd>{recipe.data.tags.length ? recipe.data.tags.join(' / ') : '—'}</dd>
						<dt>公開日</dt>
						<dd>{recipe.data.publishedDate.toLocaleDateString('ja-JP')}</dd>
					</dl>
				</section>

				<section>
					<h2>材料</h2>
					<ul>
						{recipe.data.ingredients.map((ingredient) => (
							<li>
								{ingredient.name}：{ingredient.amount}
								{ingredient.group ? `（${ingredient.group}）` : ''}
							</li>
						))}
					</ul>
				</section>

				<section>
					<h2>手順</h2>
					<ol>
						{recipe.data.steps.map((step) => (
							<li>{step}</li>
						))}
					</ol>
				</section>

				{recipe.data.equipment.length > 0 && (
					<section>
						<h2>道具</h2>
						<ul>
							{recipe.data.equipment.map((item) => (
								<li>{item}</li>
							))}
						</ul>
					</section>
				)}

				<section class="prose">
					<h2>補足</h2>
					<Content />
				</section>
			</article>
		</main>
		<Footer />
	</body>
</html>

<style>
	.recipe-header {
		margin-bottom: 2.5rem;
	}
	.recipe-type {
		text-transform: uppercase;
		letter-spacing: 0.08em;
		font-size: 0.9rem;
		color: rgba(var(--gray), 1);
		margin-bottom: 0.5rem;
	}
	.description {
		font-size: 1.1rem;
		margin-top: 0.75rem;
	}
	.recipe-meta {
		background: white;
		border-radius: 12px;
		box-shadow: var(--box-shadow);
		padding: 1.5rem;
		margin-bottom: 2.5rem;
	}
	.recipe-meta dl {
		display: grid;
		grid-template-columns: max-content 1fr;
		gap: 0.5rem 1.5rem;
		margin: 0;
	}
	.recipe-meta dt {
		font-weight: 700;
	}
</style>
